{% extends 'shop/base_ru.html' %}
{% load static i18n %}

{% block content %}
<div class="cart-page">
    <h2>Ваша корзина</h2>
    {% if items %}
    <div class="cart-items">
        {% for it in items %}
        <div class="cart-row" data-pk="{{ it.candle.pk }}">
            {% if it.candle.image and it.candle.image.url %}
                <img src="{{ it.candle.image.url }}" alt="{{ it.candle.name }}">
            {% else %}
                <img src="https://picsum.photos/seed/{{ it.candle.pk|default:0 }}/200/200" alt="{{ it.candle.name }}">
            {% endif %}
            <div class="cart-info">
                <a href="{% url 'product_detail' it.candle.pk %}"><strong>{{ it.candle.display_name }}</strong></a>
                <p>Категории: 
                    {% if it.candle.category_links.exists %}
                        {% for link in it.candle.category_links.all|slice:":2" %}
                            {{ link.category.display_name }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    {% else %}-
                    {% endif %}
                </p>
                <div class="qty-controls">
                    <button class="qty-btn cart-decrease" data-pk="{{ it.candle.pk }}">−</button>
                    <span id="qty-{{ it.candle.pk }}">{{ it.qty }}</span>
                    <button class="qty-btn cart-increase" data-pk="{{ it.candle.pk }}">+</button>
                    <button class="cart-remove" data-pk="{{ it.candle.pk }}">Удалить</button>
                </div>
            </div>
            <div class="cart-sub" id="subtotal-{{ it.candle.pk }}">{{ it.subtotal }} ₴</div>
        </div>
        {% endfor %}
    </div>
    <div class="cart-footer">
        <strong>Итого: <span id="cart-total">{{ total }}</span> ₴</strong>
        <a href="{% url 'checkout' %}" class="btn">Оформить заказ</a>
    </div>
    {% else %}
    <div class="cart-empty-illustration">
        <img src="{% static 'images/28164b10-8bc0-4cf9-bea7-fbf8024e1e1a.png' %}" alt="empty cart illustration">
        <div>
            <p><strong>Ваша корзина пуста.</strong></p>
            <p>Похоже, вы ещё не добавили товар. <a href="{% url 'product_list' %}">Перейти к товару</a></p>
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}